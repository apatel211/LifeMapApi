// Generated by CoffeeScript 1.8.0
(function() {
  var ConnectionFactory, HOMEDIR, LIB_COV, LIB_DIR, SQLClient, fs, path, should;

  fs = require('fs');

  path = require('path');

  HOMEDIR = path.join(__dirname, '..');

  LIB_COV = path.join(HOMEDIR, 'lib-cov');

  LIB_DIR = fs.existsSync(LIB_COV) ? LIB_COV : path.join(HOMEDIR, 'lib');

  ConnectionFactory = require(path.join(LIB_DIR, 'connection-factory')).ConnectionFactory;

  SQLClient = require(path.join(LIB_DIR, 'sql-client')).SQLClient;

  should = require('should');

  describe('SQLClient', function() {
    it('pre-processes SQL on execute', function(done) {
      var client, factory;
      factory = new ConnectionFactory();
      factory.open_connection = function(o, cb) {
        return cb(null, {});
      };
      factory.pre_processed = false;
      factory.pre_process_sql = function(s, b, cb) {
        factory.pre_processed = true;
        return cb(null, s, b);
      };
      factory.execute = function(c, s, b, cb) {
        factory.pre_processed.should.be.ok;
        return cb();
      };
      client = new SQLClient({}, factory);
      return client.execute("s", done);
    });
    return it('opens connection on execute if not already open', function(done) {
      var client, factory;
      factory = new ConnectionFactory();
      factory.opened = false;
      factory.open_connection = function(o, cb) {
        factory.opened = true;
        return cb(null, {});
      };
      factory.execute = function(c, s, b, cb) {
        factory.opened.should.be.ok;
        return cb();
      };
      client = new SQLClient({}, factory);
      return client.execute("s", done);
    });
  });

}).call(this);
